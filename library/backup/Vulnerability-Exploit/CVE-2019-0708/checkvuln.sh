#!/bin/bash
######Color##########
cyan='\e[1;36m'
green='\e[0;34m'
okegreen='\033[92m'
lightgreen='\e[1;32m'
white='\e[1;37m'
red='\e[1;31m'
yellow='\e[1;33m'
BlueF='\e[1;34m' #Biru
RESET="\033[00m" #normal
orange='\e[38;5;166m'
path=`pwd`
config_language="$path/../../../config/config-language"
source $config_language
if [[ "$language" = "VN" ]]; then
	open_port="Phát hiện cổng"
	is_runing="đang mở trên máy"
	check_vuln="Quét và kiểm tra trên máy chủ RDP :"
	target="Mục tiêu có tồn tại lỗ hổng bảo mật"
	not_found="Không tìm thấy lỗ hổng bảo mật này trên mục tiêu:"
	not_server="Đây không phải máy chủ RDP! hãy kiểm tra lại."
	port="Cổng"
	not_runing="không mở trên máy"
fi
################
file=ip.txt
while getopts ":p:" opt; do
	case $opt in
		p)
			rport=$OPTARG   ##LOCAL HOST PORT
		;;
	esac
done
  while IFS= read -r rhost
  do
	check_open=`nmap $rhost -p $rport | grep -i "3389/tcp open"`
	check_rdp=`nmap $rhost -p $rport | grep -w ms-wbt-server`
	if [[ "$check_open" != "" ]]; then
		echo -e "${BlueF}[!]$RESET $open_port $rport $is_runing ${white}$rhost$RESET"
		if [[ "$check_rdp" != "" ]]; then
			echo -e "${BlueF}[*]$RESET $check_vuln ${white}$rhost$RESET:$rport"
	    		check_vuln=`python CVE_2019_0708_scan.py --host $rhost --port $rport | grep -i VULNERABLE`
			if [ "$check_vuln" = "VULNERABLE" ]; then
				echo -e "${yellow}[+]$RESET $target BlueKeep (CVE_2019_0708)"
			else
				echo -e "${red}[-]${RESET} $not_found ${white}$rhost$RESET"
			fi
		else
			echo -e "${red}[-]${RESET} $not_server"
		fi
	else
		echo -e "${red}[-]${RESET} $port $rport $not_runing ${white}$rhost$RESET"
	fi
  done < $file

