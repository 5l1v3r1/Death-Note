#!/bin/bash
######Color##########
cyan='\e[1;36m'
green='\e[0;34m'
okegreen='\033[92m'
lightgreen='\e[1;32m'
white='\e[1;37m'
red='\e[1;31m'
yellow='\e[1;33m'
BlueF='\e[1;34m' #Biru
RESET="\033[00m" #normal
orange='\e[38;5;166m'
path=`pwd`
config_language="$path/../../../config/config-language"
source $config_language
if [[ "$language" = "VN" ]]; then
	open_port="Phát hiện cổng"
	is_runing="đang mở trên máy"
	check_vuln="Quét và kiểm tra trên máy chủ RDP :"
	found_vuln="Mục tiêu có tồn tại lỗ hổng bảo mật"
	not_vuln="Không tìm thấy lỗ hổng bảo mật này trên mục tiêu:"
	not_server="Đây không phải máy chủ RDP! hãy kiểm tra lại."
	port="Cổng"
	not_runing="không mở trên máy"
fi
################
file=ip.txt
while getopts ":p:t:" opt; do
	case $opt in
		p)
			rport=$OPTARG   ##LOCAL HOST PORT
		;;
		t)
			time=$OPTARG
		;;
	esac
done
  while IFS= read -r rhost
  do
	check_vuln=`python CVE_2019_0708_scan.py --host $rhost --port $rport --timeout $time | grep -e "VULNERABLE" -e "host is not connect"`
	check_vuln=`echo $check_vuln`
	if [ "$check_vuln" = "VULNERABLE!" ]; then
		echo -e "${yellow}[+]$RESET $found_vuln ${red}CVE-2019-15107${RESET}"
	elif [ "$check_vuln" = "NOT VULNERABLE host is not connect" ]; then
		echo -e "${red}[-]$RESET $not_vuln"
	elif [ "$check_vuln" = "host is not connect" ]; then
		echo -e "${red}[-]$RESET $not_server"
	fi
  done < $file
