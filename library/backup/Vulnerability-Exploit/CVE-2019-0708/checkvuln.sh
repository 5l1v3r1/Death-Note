#!/bin/bash
######Color##########
cyan='\e[1;36m'
green='\e[0;34m'
okegreen='\033[92m'
lightgreen='\e[1;32m'
white='\e[1;37m'
red='\e[1;31m'
yellow='\e[1;33m'
BlueF='\e[1;34m' #Biru
RESET="\033[00m" #normal
orange='\e[38;5;166m'
path=`pwd`
config_language="$path/../../../config/config-language"
source $config_language
################
file=ip.txt
while getopts ":p:t:" opt; do
	case $opt in
		p)
			rport=$OPTARG   ##LOCAL HOST PORT
		;;
		t)
			time=$OPTARG
		;;
	esac
done
  while IFS= read -r rhost
  do
	check_vuln=`python CVE_2019_0708_scan.py --host $rhost --port $rport --timeout $time | grep -e "VULNERABLE" -e "host is not connect"`
	check_vuln=`echo $check_vuln`
	if [[ "$language" = "VN" ]]; then
		if [ "$check_vuln" = "VULNERABLE!" ]; then
			echo -e "${yellow}[+]$RESET $rhost - Mục tiêu này có thể bị tấn công bởi lỗ hổng bảo mật ${red}CVE-2019-0708${RESET}!."
		elif [ "$check_vuln" = "NOT VULNERABLE host is not connect" ]; then
			echo -e "${red}[-]$RESET $rhost - Mục tiêu này đã được vá lỗi hoặc không chịu ảnh hưởng của lỗ hổng này."
		elif [ "$check_vuln" = "host is not connect" ]; then
			echo -e "${red}[-]$RESET $rhost - Máy chủ này hiện không mở hoặc có thể đã đổi cổng RDP."
		fi
	elif [[ "$language" = "EN" ]]; then
		if [ "$check_vuln" = "VULNERABLE!" ]; then
			echo -e "${yellow}[+]$RESET $rhost - This target could be attacked by vulnerability ${red}CVE-2019-0708${RESET}!"
		elif [ "$check_vuln" = "NOT VULNERABLE host is not connect" ]; then
			echo -e "${red}[-]$RESET $rhost - This target has been patched or is not affected by this vulnerability."
		elif [ "$check_vuln" = "host is not connect" ]; then
			echo -e "${red}[-]$RESET $rhost - This server is currently not running or may have changed the RDP port."
		fi
	fi
  done < $file
